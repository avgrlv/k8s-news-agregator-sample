# **Система: "Агрегатор новостей"**

> **Описание:** 
система предназначена для сбора, обработки и предоставления пользователям актуальных новостей из различных источников. Она состоит из нескольких микросервисов, которые взаимодействуют между собой через REST API и брокер сообщений. Система также использует внешние зависимости для получения данных и хранения их в базе данных.

## Компоненты системы

1. **News Collector Service (Сборщик новостей)**

    **Образ:** `news-collector:v1.0`

    **Описание:** сервис, который периодически опрашивает внешние REST API новостных источников и собирает новости.

    **Функции:**
    1. Получение данных из внешних источников.
    2. Фильтрация и предварительная обработка данных.
    3. Отправка новостей в очередь сообщений для дальнейшей обработки.

    **Внешние зависимости:**
    1. NewsAPI (REST API)
    2. RSS-каналы

    **Компоненты k8s:**

    1. CronJob: Запускает сервис каждые 10 минут для сбора новостей.
    2. ConfigMap: Хранит конфигурацию (например, URL API, ключи доступа).
    3. Secret: Хранит API-ключи для доступа к внешним источникам.
        
2. **News Processor Service (Обработчик новостей)**

	**Образ:** `news-processor:v1.0`

    **Описание:** сервис, который получает новости из брокера сообщений, обрабатывает их (например, удаляет дубликаты, классифицирует по категориям) и сохраняет в базу данных.

	**Функции:**
	1. Чтение сообщений из брокера сообщений.
	2. Обработка и классификация новостей.
	3. Сохранение данных в базу данных.

	**Компоненты k8s:**
	1. Deployment: запускает несколько реплик для обработки сообщений.
	2. Service: обеспечивает внутренний доступ к сервису.
	3. ConfigMap: хранит конфигурацию (параметры подключения к брокеру сообщений и базе данных).      

3. **News API Service (API для предоставления новостей)**

	**Образ:** `news-api:v1.0`

	**Описание:** REST API сервис, который предоставляет пользователям доступ к новостям.

	**Функции:**
	1. Получение запросов от пользователей.
	2. Запрос данных из базы данных.
	3. Возвращение новостей в формате JSON.
	
    **Компоненты k8s:**
	1. Deployment: запускает несколько реплик для обработки запросов.
	2. Service: обеспечивает внутренний и внешний доступ к API.
	3. Ingress: настраивает внешний доступ к API через HTTP/HTTPS.

4. **Внешние зависимости:**
    * **БД PostgreSQL:**
        - Хранит все новости и метаданные.
        - Порт: 5432
        - Сервер: Отдельный сервер с 4 ядрами CPU, 8 ГБ RAM, 100 ГБ SSD.
    * **Брокер сообщений (RabbitMQ)**:
        - Используется для передачи новостей между сервисами.
        - Порт: 5672
        - Сервер: Отдельный сервер с 2 ядрами CPU, 4 ГБ RAM, 50 ГБ SSD.

### Конфигурация Kubernetes

1. **Deployment (News Processor и News API):**
	1. News Processor:
	    - Replicas: 3
	    - Request/Limit:
		    - CPU:  500m / 1000m
		    - Memory: 512Mi/1Gi
	2. News API:
		- Replicas: 3
		-  Request/Limit:
		    - CPU:  500m / 1000m
		    - Memory: 512Mi/1Gi
2. **CronJob (News Collector):**
    - Schedule: "*/10 * * * *" (каждые 10 минут)
    - Request/Limit:
        - CPU: 200m / 500m
        - Memory: 256Mi / 512Mi
3. **Ingress (News API):**
    - Порт: 80/443
    - Правила маршрутизации:
        - `/api/v1/news` -> News API Service
4. **ConfigMap и Secret:**
    - ConfigMap: хранит настройки подключения к RabbitMQ и PostgreSQL.
    - Secret: хранит API-ключи для внешних источников новостей.


## Network Policies

С помощью Network Policies разгарничен доступ между сервисами:

1. News Collector может взаимодействовать только с RabbitMQ.
2. News Processor может взаимодействовать с RabbitMQ и PostgreSQL.
3. News API может взаимодействовать с PostgreSQL и принимать запросы от Ingress.
4. PostgreSQL и RabbitMQ принимают запросы только от определенных сервисов.